<!DOCTYPE html>
<html lang="en" data-root="https://fsprojects.github.io/fantomas/">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Florian Verdonck, Jindřich Ivánek, David Schaefer">
  <title>Formatting Check
</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;1,400&family=Reem+Kufi:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
  <link rel="shortcut icon" type="image/x-icon" href="https://fsprojects.github.io/fantomas/images/favicon.ico">
  <link type="text/css" rel="stylesheet" href="https://fsprojects.github.io/fantomas/content/fsdocs-custom.css" />
  <script type="text/javascript" src="https://fsprojects.github.io/fantomas/content/fsdocs-tips.js"></script>
  <!-- BEGIN SEARCH BOX: this adds support for the search box -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
  <!-- END SEARCH BOX: this adds support for the search box -->
  
</head>

<body>
     <aside class="bg-primary h-100 fs-5">
      <div id="sidebar-header" class="d-flex justify-content-end mt-1 d-md-none">
      <button class="btn d-md-none" id="close-mobile-menu" aria-controls="sidebar-wrapper" aria-expanded="false" aria-label="Toggle navigation">
        <i class="sidebar-toggle fs-3 bi bi-x-lg"></i>
                  </button>
              </div>
      <div id="sidebar-logo" class="d-flex justify-content-center p-5">
        <a href="https://fsprojects.github.io/fantomas/docs/index.html" ><img id="fsdocs-logo" src="https://fsprojects.github.io/fantomas//images/logo-fantomas-white.svg" /></a>
      </div>
      <div id="sidebar-content" class="accordion accordion-flush ps-0 text-white fs-6">
        <div id="end-users-wrapper" class="accordion-item">
    <li class="docs-menu">
        <button id="end-users-button"
            class="accordion-button collapsed btn text-white d-flex justify-content-between align-items-center"
            data-bs-toggle="collapse" data-bs-target="#end-users" aria-expanded="false"
            aria-control="end-users" type="button">
            End-users
        </button>
        <div id="end-users" class="accordion-collapse collapse ps-4 pb-2 " data-bs-parent="#sidebar-content">
            <ul class="list-unstyled fw-normal mb-0">
                <li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/GettingStarted.html" class="nav-link pb-2 d-block" > Getting Started
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/StyleGuide.html" class="nav-link pb-2 d-block" > Style guide
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/Configuration.html" class="nav-link pb-2 d-block" > Configuration
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/IgnoreFiles.html" class="nav-link pb-2 d-block" > Ignore Files
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/FormattingCheck.html" class="nav-link pb-2 d-block" > Formatting Check
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/GitHooks.html" class="nav-link pb-2 d-block" > Git hooks
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/Rider.html" class="nav-link pb-2 d-block" > JetBrains Rider
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/VisualStudio.html" class="nav-link pb-2 d-block" > Visual Studio
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/VSCode.html" class="nav-link pb-2 d-block" > Visual Studio Code
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/GeneratingCode.html" class="nav-link pb-2 d-block" > Generating source code
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/UpgradeGuide.html" class="nav-link pb-2 d-block" > Upgrade guide
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/FAQ.html" class="nav-link pb-2 d-block" > FAQ
</a></li>

            </ul>
        </div>
    </li>
</div>
<div id="contributors-wrapper" class="accordion-item">
    <li class="docs-menu">
        <button id="contributors-button"
            class="accordion-button collapsed btn text-white d-flex justify-content-between align-items-center"
            data-bs-toggle="collapse" data-bs-target="#contributors" aria-expanded="false"
            aria-control="contributors" type="button">
            Contributors
        </button>
        <div id="contributors" class="accordion-collapse collapse ps-4 pb-2 " data-bs-parent="#sidebar-content">
            <ul class="list-unstyled fw-normal mb-0">
                <li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Index.html" class="nav-link pb-2 d-block" > Contributors
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/FSharp.html" class="nav-link pb-2 d-block" > F#
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Getting Started.html" class="nav-link pb-2 d-block" > Getting started
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Solution Structure.html" class="nav-link pb-2 d-block" > Solution structure
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Transforming.html" class="nav-link pb-2 d-block" > Fantomas.Core overview (1)
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Traverse.html" class="nav-link pb-2 d-block" > Fantomas.Core overview (2)
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Formatted Code.html" class="nav-link pb-2 d-block" > Fantomas.Core overview (3)
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Conditional Compilation Directives.html" class="nav-link pb-2 d-block" > Formatting Conditional Compilation Directives
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/How Can I Contribute.html" class="nav-link pb-2 d-block" > How can I contribute?
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/The Missing Comment.html" class="nav-link pb-2 d-block" > The Missing Comment
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Multiple Times.html" class="nav-link pb-2 d-block" > Fantomas is trying to format the input multiple times due to the detection of multiple defines
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Pull request ground rules.html" class="nav-link pb-2 d-block" > Pull request ground rules
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Updating the compiler.html" class="nav-link pb-2 d-block" > Updating the compiler sources
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Releases.html" class="nav-link pb-2 d-block" > Releases
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Glossary.html" class="nav-link pb-2 d-block" > Glossary
</a></li>

            </ul>
        </div>
    </li>
</div>
        <div id="api_reference-wrapper" class="accordion-item">
    <li class="docs-menu">
        <button id="api_reference-button"
            class="accordion-button collapsed btn text-white d-flex justify-content-between align-items-center"
            data-bs-toggle="collapse" data-bs-target="#api_reference" aria-expanded="false"
            aria-control="api_reference" type="button">
            API Reference
        </button>
        <div id="api_reference" class="accordion-collapse collapse ps-4 pb-2 " data-bs-parent="#sidebar-content">
            <ul class="list-unstyled fw-normal mb-0">
                <li class="nav-item"><a href="https://fsprojects.github.io/fantomas/reference/index.html" class="nav-link pb-2 d-block" > All Namespaces</a></li>

            </ul>
        </div>
    </li>
</div>
      </div>
    </aside>
    <main class="doc-content">
     <nav class="navbar navbar-expand-sm border py-1">
        <div class="container-fluid flex-nowrap">
          <button class="btn" id="toggle-mobile-menu" aria-expanded="false" aria-label="Toggle navigation">
            <i class="sidebar-toggle fs-3 bi bi-list"></i>
          </button>
          <div id="mobile-navbar" class="container-fluid d-flex justify-content-between d-sm-none">
            <i class="invisible bi bi-github fs-3 align-self-end"></i>
         <a href="./index.html" ><img id="fsdocs-logo-mobile" width="32" height="32" src="https://fsprojects.github.io/fantomas//images/logo.png" /></a>
            <a class="nav-link m-0 p-0" target="_blank" href="https://github.com/fsprojects/fantomas/"> <i class="bi bi-github fs-3 align-self-end"></i>
</a>
          </div>
          <div class="collapse navbar-collapse" id="navbarText">
            <div class="navbar-nav me-auto mb-2 mb-lg-0 fs-5">
                <a class="nav-link active" aria-current="page" href="https://fsprojects.github.io/fantomas/docs/index.html">Docs</a>
                <a class="nav-link" target="_blank" href="https://fsprojects.github.io/fantomas-tools/">Tools</a>
            </div>
            <form class="d-flex">
              <div class="input-group me-4">
              <label for="search-by">
                <i class="fas fa-search"></i>
              </label>
                <div class="btn border-end-0 border">
                  <i class="bi bi-search"></i>
                </div>
                <input aria-label="Search" class="form-control  border-start-0 border" data-search-input=""
                  id="search-by" type="search" placeholder="Search..." />
                <span class="input-group-append">
                </span>
                <span data-search-clear="">
                  <i class="fas fa-times"></i>
                </span>
              </div>
            </form>
            <a class="nav-link m-0 p-0" target="_blank" href="https://github.com/fsprojects/fantomas/">GitHub<i
                class="bi bi-box-arrow-up-right mx-2"></i></a>
          </div>
        </div>
      </nav>
      <div id="fsdocs-content" class="bg-white m-2 m-sm-5 p-3 p-sm-4">
        
<h1><a name="Formatting-Check" class="anchor" href="#Formatting-Check">Formatting Check</a></h1>
<p>Formatting source code is a habit, a step in your developer workflow.<br />
The benefits of consistently formatting is that <strong>your delta</strong> (<em>typically the changes in the files of a pull request</em>) will be the <strong>smallest set possible</strong> if every previous change was formatted.</p>
<h2><a name="The-tragedy-of-the-ancient-Greek-developers" class="anchor" href="#The-tragedy-of-the-ancient-Greek-developers">The tragedy of the ancient Greek developers</a></h2>
<p>When working with multiple people on the same code base, it is important (to some degrees) that you cannot distinguish who wrote the code.
If you agree as a team that you need to write unit tests to guarantee the code quality, you expect every developer to cover any new code with a test.<br />
Formatting is no different, every developer should do it and it is an acceptance criteria for new code.</p>
<p>Imagine we have multiple developers in our team. Hektor made the initial setup and during a team meeting it was decided that the code should always be formatted.<br />
Once the initial project structure was delivered, Achilles made a change where the code was not formatted.<br />
The next day, Odysseus wants to submit a new pull request. As agreed code should be formatted, so Odysseus did exactly that.
As the changes Achilles made were not formatted, there was more code touched than was absolutely necessary. Perseus didn't see any harm in this rectification and merge the pull request as is.</p>
<p>A week later, a huge problem was discovered in production. There was data loss and the entire company was on fire.
Fuelled by rage and anger Hektor wanted to know who was responsible for this devastating tragedy. You guessed it, somebody's head was about to roll.
Perseus was tasked with getting to the bottom of this mystery and eventually he located the source of the misery.  Hektor tasked him with running a <code>git blame</code> command, to see who the culprit really was.</p>
<p>Odysseus credentials showed up, but it was the function Achilles originally wrote. Unable to escape Hektor's wrath, Odysseus was fired immediately.
Achilles felt bad but couldn't come clean as he was about to get surgery for his heel. Odysseus took the fall like a true hero.
But it lead him to a downwards spiral and would take him ten years before he could land another job in the software industry.</p>
<h3><a name="Aftermath" class="anchor" href="#Aftermath">Aftermath</a></h3>
<p>The team was shocked by what had transpired. Besides Hektor overreacting, another painful meeting was planned to have a retrospective on the past events.<br />
After asking five why's, the team had to brainstorm on how to avoid these things.</p>
<p>Ultimately, that meeting was mostly about the contents of the function Achilles wrote, but to end on a high note, the team discussed formatting source code afterwards.</p>
<p>The moral of this story is that there are two things that could have saved Odysseus: <strong>a formatting check during continuous integration</strong> and a <code>.git-blame-ignore-revs</code> file.</p>
<h2><a name="check" class="anchor" href="#check">--check</a></h2>
<p><em>starting version 3.3</em></p>
<p>Verify that a single file or folder was formatted correctly.</p>
<blockquote>
<p>dotnet fantomas --check Source.fs</p>
</blockquote>
<p>This will verify if the file <code>Source.fs</code> still needs formatting.
If it does, the process will return exit code <strong>99</strong>.
In the case that the file does not require any formatting, exit code 0 is returned.
Unexpected errors will return exit code 1.</p>
<p>This scenario is meant to be executed in a continuous integration environment, to enforce that the newly added code was formatted correctly.</p>
<h3><a name="FAKE" class="anchor" href="#FAKE">FAKE</a></h3>
<p>If you are using <code>FAKE</code> by any chance, a good step is to have <code>CheckFormat</code> target early on in the pipeline.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Target</span><span class="pn">.</span><span class="id">create</span> <span class="s">&quot;CheckFormat&quot;</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">_</span> <span class="k">-&gt;</span>
    <span class="k">let</span> <span class="id">result</span> <span class="o">=</span>
        <span class="id">DotNet</span><span class="pn">.</span><span class="id">exec</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">id</span> <span class="s">&quot;fantomas ourSourceFolder --recurse --check&quot;</span>

    <span class="k">if</span> <span class="id">result</span><span class="pn">.</span><span class="id">ExitCode</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span>
        <span class="id">Trace</span><span class="pn">.</span><span class="id">log</span> <span class="s">&quot;No files need formatting&quot;</span>
    <span class="k">elif</span> <span class="id">result</span><span class="pn">.</span><span class="id">ExitCode</span> <span class="o">=</span> <span class="n">99</span> <span class="k">then</span>
        <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="id">failwith</span> <span class="s">&quot;Some files need formatting, run \&quot;dotnet fantomas  ourSourceFolder --recurse\&quot; to resolve this.&quot;</span>
    <span class="k">else</span>
        <span class="id">Trace</span><span class="pn">.</span><span class="id">logf</span> <span class="s">&quot;Errors while formatting: %A&quot;</span> <span class="id">result</span><span class="pn">.</span><span class="id">Errors</span><span class="pn">)</span>
        
<span class="c">// ... more targets</span>

<span class="s">&quot;Clean&quot;</span>
<span class="pn">==&gt;</span> <span class="s">&quot;CheckFormat&quot;</span>
<span class="pn">==&gt;</span> <span class="s">&quot;Build&quot;</span>
<span class="pn">==&gt;</span> <span class="s">&quot;UnitTests&quot;</span>
<span class="pn">==&gt;</span> <span class="s">&quot;Benchmark&quot;</span>
<span class="pn">==&gt;</span> <span class="s">&quot;Pack&quot;</span>
<span class="pn">==&gt;</span> <span class="s">&quot;Docs&quot;</span>
<span class="pn">==&gt;</span> <span class="s">&quot;All&quot;</span>

<span class="id">Target</span><span class="pn">.</span><span class="id">runOrDefault</span> <span class="s">&quot;All&quot;</span>
</code></pre>
<p>The recommendation is to install <code>fantomas</code> as a local tool and run it using the generic <code>DotNet.exec</code> api.
This translates to running <code>dotnet fantomas ourSourceFolder --recurse --check</code>.</p>
<h3><a name="Any-other-continuous-integration-environment" class="anchor" href="#Any-other-continuous-integration-environment">Any other continuous integration environment</a></h3>
<p>You want to restore your local <code>fantomas</code> tool using <code>dotnet tool restore</code>.
Next, you want to run <code>dotnet fantomas &lt;input&gt; --check</code> and make sure your continuous integration environment <strong>fails</strong> your job when <strong>a non-zero exit code</strong> is returned.</p>
<p><strong>Pro-tip</strong>: print the command users need to run to fix the formatting in the output log when the check failed. This is useful for open-source projects where new contributors might never have been exposed to formatting.</p>
<h2><a name="A-git-blame-ignore-revs-file" class="anchor" href="#A-git-blame-ignore-revs-file">A git-blame-ignore-revs file</a></h2>
<p>By default, Fantomas adheres to the Microsoft <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/style-guide/formatting">F# code formatting guidelines</a>.
If these change, Fantomas will follow accordingly. Due to this reason, the output cannot be guaranteed to remain the same when upgrading to a new minor version.</p>
<p>If you are using Git for your source control, it is recommended to ignore commits where <code>fantomas</code> was updated using a <a href="https://git-scm.com/docs/git-blame#Documentation/git-blame.txt---ignore-revltrevgt">.git-blame-ignore-revs file</a>.
Check out this <a href="https://www.moxio.com/blog/43/ignoring-bulk-change-commits-with-git-blame">blogpost</a> for more details.</p>
<p>Adding a formatting commit to a configured <code>.git-blame-ignore-revs</code> file will prevent you from drawing the wrong conclusions when running a <code>git blame</code> command.
One thing to note is that if you add a commit SHA to a <code>.git-blame-ignore-revs</code> file, you cannot squash the commit when merging in the pull request.</p>
<h2><a name="Checking-is-good-for-regressions" class="anchor" href="#Checking-is-good-for-regressions">Checking is good for regressions</a></h2>
<p>Normally, the rule of thumb is that the code style will not change between revisions.<br />
If you are using <code>4.7.2</code>, then it should be safe for you upgrade to the latest <code>4.7.X</code> without seeing any changes.</p>
<blockquote>
<p>Life happens, so this is a best effort guarantee</p>
</blockquote>
<p>In case you do see a change that cannot be linked to anything in the <a href="https://github.com/fsprojects/fantomas/blob/main/CHANGELOG.md">CHANGELOG.md</a> file, you may have detected a regression.<br />
Or, more likely, you have something slightly different in your code base that isn't covered yet by a unit test.</p>
<p>No matter the case, when you have a <code>--check</code> command somewhere in your continuous integration environment, please consider running a build with the latest compatible version from time to time.<br />
It really helps us spotting problems early on and we can more easily pinpoint the problem due to lesser recent changes.</p>
<fantomas-nav previous="IgnoreFiles.html" next="GitHooks.html"></fantomas-nav>

        <div class="fsdocs-tip" id="fs1">val id: x: &#39;T -&gt; &#39;T</div>
<div class="fsdocs-tip" id="fs2">val failwith: message: string -&gt; &#39;T</div>

      </div>
        <div id="push"></div>
    </main>
  <script type="module" src="https://fsprojects.github.io/fantomas/content/docs-setup.js"></script>
  <!-- BEGIN SEARCH BOX: this adds support for the search box -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
  <script type="text/javascript">var fsdocs_search_baseurl = 'https://fsprojects.github.io/fantomas/';</script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.min.js"></script>
  <script type="text/javascript" src="https://fsprojects.github.io/fantomas/content/fsdocs-search.js"></script>
  <!-- END SEARCH BOX: this adds support for the search box -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
  <script type="module" src="https://fsprojects.github.io/fantomas/content/webcomponents.js"></script>
  <script type="module">
      import mermaid from "https://cdn.skypack.dev/mermaid@9.2.2";
      mermaid.initialize({
          startOnLoad: true,
          theme: "base",
          themeVariables: {
              primaryColor: '#eff5f7'
          }
      });
  </script>
</body>
</html>