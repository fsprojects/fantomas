<!DOCTYPE html>
<html lang="en" data-root="https://fsprojects.github.io/fantomas/">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Florian Verdonck, Jindřich Ivánek, David Schaefer" name="author">
    <!-- Opengraph properties (https://ogp.me/) -->
    <meta property="og:site_name" content="fantomas">
    <meta property="og:title" content="Generating source code
" />
    <meta property="og:url" content="https://fsprojects.github.io/fantomas/docs/end-users/GeneratingCode.html">
    <meta property="og:type" content="website" />
    <!-- Twitter cards (https://developer.twitter.com/en/docs/twitter-for-websites/cards/overview/summary-card-with-large-image) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="https://fsprojects.github.io/fantomas/">
    <meta name="twitter:title" content="Generating source code
">
    
    <title>Generating source code
 | fantomas</title>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="https://fsprojects.github.io/fantomas/images/favicon.ico" rel="icon" sizes="32x32" type="image/png"/>
    <script type="application/javascript" src="https://fsprojects.github.io/fantomas/content/fsdocs-theme-set-dark.js"></script>
    <script type="application/javascript" src="https://fsprojects.github.io/fantomas/content/fsdocs-details-set-expanded.js"></script>
    <link href="https://fsprojects.github.io/fantomas/content/fsdocs-default.css" rel="stylesheet" type="text/css"/>
    <link href="https://fsprojects.github.io/fantomas/content/fsdocs-theme.css" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;1,400&family=Reem+Kufi:wght@400;500;700&display=swap" rel="stylesheet">

    
</head>
<body class="content">
<header>
    <div class="start">
        <div id="menu-toggle">
            <iconify-icon class="icon closed" height="22" icon="eva:menu-fill" width="22"></iconify-icon>
            <iconify-icon class="icon open" height="22" icon="mi:close" width="22"></iconify-icon>
            <input type="checkbox" name="mobile-menu" />
            <ul class="menu">
                <li class="nav-header">Links</li>
                <li class="nav-item"><a class="nav-link" href="https://github.com/fsprojects/fantomas/blob/main/LICENSE.md">License</a>
                </li>
                <li class="nav-item"><a class="nav-link"
                                        href="https://github.com/fsprojects/fantomas/blob/main/CHANGELOG.md">Release
                    Notes</a></li>
                <li class="nav-item"><a class="nav-link" href="https://github.com/fsprojects/fantomas/">Source
                    Repository</a></li>
                <li class="nav-header active" id="end-users">
    End-users
    <iconify-icon icon="fluent:chevron-up-24-regular" width="32" height="32" rotate="180deg"></iconify-icon>
</li>
<div class="menu-items">
    <li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/GettingStarted.html" class="nav-link" > Getting Started
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/StyleGuide.html" class="nav-link" > Style guide
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/Configuration.html" class="nav-link" > Configuration
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/IgnoreFiles.html" class="nav-link" > Ignore Files
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/FormattingCheck.html" class="nav-link" > Formatting Check
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/GitHooks.html" class="nav-link" > Git hooks
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/Rider.html" class="nav-link" > JetBrains Rider
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/VisualStudio.html" class="nav-link" > Visual Studio
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/VSCode.html" class="nav-link" > Visual Studio Code
</a></li>

<li class="nav-item active"><a href="https://fsprojects.github.io/fantomas/docs/end-users/GeneratingCode.html" class="nav-link" > Generating source code
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/UpgradeGuide.html" class="nav-link" > Upgrade guide
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/Recipes.html" class="nav-link" > Recipes
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/FAQ.html" class="nav-link" > FAQ
</a></li>

</div>
<li class="nav-header " id="contributors">
    Contributors
    <iconify-icon icon="fluent:chevron-up-24-regular" width="32" height="32" rotate="180deg"></iconify-icon>
</li>
<div class="menu-items">
    <li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Index.html" class="nav-link" > Contributors
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/FSharp.html" class="nav-link" > F#
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Getting Started.html" class="nav-link" > Getting started
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Solution Structure.html" class="nav-link" > Solution structure
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Transforming.html" class="nav-link" > Fantomas.Core overview (1)
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Traverse.html" class="nav-link" > Fantomas.Core overview (2)
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Formatted Code.html" class="nav-link" > Fantomas.Core overview (3)
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Conditional Compilation Directives.html" class="nav-link" > Formatting Conditional Compilation Directives
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/How Can I Contribute.html" class="nav-link" > How can I contribute?
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/The Missing Comment.html" class="nav-link" > The Missing Comment
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Multiple Times.html" class="nav-link" > Fantomas is trying to format the input multiple times due to the detection of multiple defines
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Pull request ground rules.html" class="nav-link" > Pull request ground rules
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Updating the compiler.html" class="nav-link" > Updating the compiler sources
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Releases.html" class="nav-link" > Releases
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Glossary.html" class="nav-link" > Glossary
</a></li>

</div>
                <li class="nav-header " id="api_reference">
    API Reference
    <iconify-icon icon="fluent:chevron-up-24-regular" width="32" height="32" rotate="180deg"></iconify-icon>
</li>
<div class="menu-items">
    <li class="nav-item active"><a href="https://fsprojects.github.io/fantomas/reference/index.html" class="nav-link" > All Namespaces</a></li>

</div>
            </ul>
        </div>
        <a href="https://fsprojects.github.io/fantomas/">
            <img alt="Header menu logo" src="https://fsprojects.github.io/fantomas/images/logo.png">
            <strong>fantomas</strong>
        </a>
    </div>
    <div class="end">
        <a href="https://github.com/fsprojects/fantomas/" target="_blank">
            <iconify-icon icon="uil:github" width="26" height="26"></iconify-icon>
        </a>
        <iconify-icon id="search-btn" icon="carbon:search" class="search" width="24" height="24"></iconify-icon>
        <fsdocs-theme-toggle></fsdocs-theme-toggle>
    </div>
</header>
<aside id="fsdocs-main-menu">
    <ul class="menu">
        <li class="nav-header">Links</li>
        <li class="nav-item"><a class="nav-link" href="https://github.com/fsprojects/fantomas/blob/main/LICENSE.md">License</a>
        </li>
        <li class="nav-item"><a class="nav-link"
                                href="https://github.com/fsprojects/fantomas/blob/main/CHANGELOG.md">Release
            Notes</a></li>
        <li class="nav-item"><a class="nav-link" href="https://github.com/fsprojects/fantomas/">Source
            Repository</a></li>
        <li class="nav-header active" id="end-users">
    End-users
    <iconify-icon icon="fluent:chevron-up-24-regular" width="32" height="32" rotate="180deg"></iconify-icon>
</li>
<div class="menu-items">
    <li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/GettingStarted.html" class="nav-link" > Getting Started
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/StyleGuide.html" class="nav-link" > Style guide
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/Configuration.html" class="nav-link" > Configuration
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/IgnoreFiles.html" class="nav-link" > Ignore Files
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/FormattingCheck.html" class="nav-link" > Formatting Check
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/GitHooks.html" class="nav-link" > Git hooks
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/Rider.html" class="nav-link" > JetBrains Rider
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/VisualStudio.html" class="nav-link" > Visual Studio
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/VSCode.html" class="nav-link" > Visual Studio Code
</a></li>

<li class="nav-item active"><a href="https://fsprojects.github.io/fantomas/docs/end-users/GeneratingCode.html" class="nav-link" > Generating source code
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/UpgradeGuide.html" class="nav-link" > Upgrade guide
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/Recipes.html" class="nav-link" > Recipes
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/end-users/FAQ.html" class="nav-link" > FAQ
</a></li>

</div>
<li class="nav-header " id="contributors">
    Contributors
    <iconify-icon icon="fluent:chevron-up-24-regular" width="32" height="32" rotate="180deg"></iconify-icon>
</li>
<div class="menu-items">
    <li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Index.html" class="nav-link" > Contributors
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/FSharp.html" class="nav-link" > F#
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Getting Started.html" class="nav-link" > Getting started
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Solution Structure.html" class="nav-link" > Solution structure
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Transforming.html" class="nav-link" > Fantomas.Core overview (1)
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Traverse.html" class="nav-link" > Fantomas.Core overview (2)
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Formatted Code.html" class="nav-link" > Fantomas.Core overview (3)
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Conditional Compilation Directives.html" class="nav-link" > Formatting Conditional Compilation Directives
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/How Can I Contribute.html" class="nav-link" > How can I contribute?
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/The Missing Comment.html" class="nav-link" > The Missing Comment
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Multiple Times.html" class="nav-link" > Fantomas is trying to format the input multiple times due to the detection of multiple defines
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Pull request ground rules.html" class="nav-link" > Pull request ground rules
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Updating the compiler.html" class="nav-link" > Updating the compiler sources
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Releases.html" class="nav-link" > Releases
</a></li>

<li class="nav-item "><a href="https://fsprojects.github.io/fantomas/docs/contributors/Glossary.html" class="nav-link" > Glossary
</a></li>

</div>
        <li class="nav-header " id="api_reference">
    API Reference
    <iconify-icon icon="fluent:chevron-up-24-regular" width="32" height="32" rotate="180deg"></iconify-icon>
</li>
<div class="menu-items">
    <li class="nav-item active"><a href="https://fsprojects.github.io/fantomas/reference/index.html" class="nav-link" > All Namespaces</a></li>

</div>
    </ul>
</aside>
<main>
    <div id="content">
        
<h1><a name="Generating-source-code" class="anchor" href="#Generating-source-code">Generating source code</a></h1>
<p>The <a href="https://www.nuget.org/packages/Fantomas.Core">Fantomas.Core</a> NuGet package can also be used to format code programmatically.<br />
The public API is available from the static <code>CodeFormatter</code> class. It exposes a couple of APIs to format code, one being to format code from a raw syntax tree.<br />
This API assumes the user already parsed a syntax tree or constructed an artificial one.</p>
<h2><a name="Key-motivation" class="anchor" href="#Key-motivation">Key motivation</a></h2>
<p>It can be very tempting to generate some F# code by doing some string concatenations.<br />
In simple scenarios this can work out, but in the long run it doesn't scale well:</p>
<ul>
<li>The more code constructs you want to support, the more conditional logic you will need to ensure all edge cases.</li>
<li>A string is just a string, you cannot guarantee the output will be valid code.</li>
<li>It is easier to map your domain model to untyped syntax tree nodes and let Fantomas take care of the actual generation of code.</li>
</ul>
<p><strong>For mercy's sake don't use string concatenation when generating F# code, use Fantomas instead. It is battle tested and proven technology!</strong></p>
<h2><a name="Consider-using-Fabulous-AST" class="anchor" href="#Consider-using-Fabulous-AST">Consider using Fabulous.AST</a></h2>
<p>If you're looking to generate F# code programmatically, you might want to check out <a href="https://edgarfgp.github.io/Fabulous.AST/">Fabulous.AST</a> first.<br />
Fabulous.AST provides a more user-friendly DSL built on top of Fantomas Oak AST, dramatically reducing the boilerplate code required to generate F# code.<br />
It offers a concise and easier-to-use API compared to constructing Oak nodes directly, which can be quite verbose.</p>
<p>The rest of this page documents how to work with Fantomas Oak AST directly, which is useful if you need more control or want to understand the underlying structure.</p>
<h2><a name="Generating-source-code-from-scratch" class="anchor" href="#Generating-source-code-from-scratch">Generating source code from scratch</a></h2>
<h3><a name="Example-syntax-tree" class="anchor" href="#Example-syntax-tree">Example syntax tree</a></h3>
<p>To illustrate the API, lets generate a simple value binding: <code>let a = 0</code>.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="pp">#r</span> <span class="s">&quot;../../../artifacts/bin/Fantomas.FCS/release/Fantomas.FCS.dll&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;../../../artifacts/bin/Fantomas.Core/release/Fantomas.Core.dll&quot;</span> <span class="c">// In production use #r &quot;nuget: Fantomas.Core, 6.*&quot;</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">Fantomas</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="id">FCS</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="id">Text</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 4)" onmouseover="showTip(event, 'fs1', 4)" class="id">Fantomas</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="id">Core</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="m">SyntaxOak</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="id">implementationSyntaxTree</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="fn">Oak</span><span class="pn">(</span>
        <span class="pn">[</span><span class="pn">]</span><span class="pn">,</span>
        <span class="pn">[</span> <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="fn">ModuleOrNamespaceNode</span><span class="pn">(</span>
              <span onmouseout="hideTip(event, 'fs9', 10)" onmouseover="showTip(event, 'fs9', 10)" class="uc">None</span><span class="pn">,</span>
              <span class="pn">[</span> <span onmouseout="hideTip(event, 'fs10', 11)" onmouseover="showTip(event, 'fs10', 11)" class="fn">BindingNode</span><span class="pn">(</span>
                    <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="uc">None</span><span class="pn">,</span>
                    <span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="uc">None</span><span class="pn">,</span>
                    <span onmouseout="hideTip(event, 'fs11', 14)" onmouseover="showTip(event, 'fs11', 14)" class="fn">MultipleTextsNode</span><span class="pn">(</span><span class="pn">[</span> <span onmouseout="hideTip(event, 'fs12', 15)" onmouseover="showTip(event, 'fs12', 15)" class="fn">SingleTextNode</span><span class="pn">(</span><span class="s">&quot;let&quot;</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 16)" onmouseover="showTip(event, 'fs13', 16)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 17)" onmouseover="showTip(event, 'fs14', 17)" class="id">Zero</span><span class="pn">)</span> <span class="pn">]</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 18)" onmouseover="showTip(event, 'fs13', 18)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 19)" onmouseover="showTip(event, 'fs14', 19)" class="id">Zero</span><span class="pn">)</span><span class="pn">,</span>
                    <span class="k">false</span><span class="pn">,</span>
                    <span onmouseout="hideTip(event, 'fs9', 20)" onmouseover="showTip(event, 'fs9', 20)" class="uc">None</span><span class="pn">,</span>
                    <span onmouseout="hideTip(event, 'fs9', 21)" onmouseover="showTip(event, 'fs9', 21)" class="uc">None</span><span class="pn">,</span>
                    <span onmouseout="hideTip(event, 'fs15', 22)" onmouseover="showTip(event, 'fs15', 22)" class="uc">Choice1Of2</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs16', 23)" onmouseover="showTip(event, 'fs16', 23)" class="fn">IdentListNode</span><span class="pn">(</span><span class="pn">[</span> <span onmouseout="hideTip(event, 'fs17', 24)" onmouseover="showTip(event, 'fs17', 24)" class="rt">IdentifierOrDot</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs18', 25)" onmouseover="showTip(event, 'fs18', 25)" class="id">Ident</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs12', 26)" onmouseover="showTip(event, 'fs12', 26)" class="fn">SingleTextNode</span><span class="pn">(</span><span class="s">&quot;a&quot;</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 27)" onmouseover="showTip(event, 'fs13', 27)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 28)" onmouseover="showTip(event, 'fs14', 28)" class="id">Zero</span><span class="pn">)</span><span class="pn">)</span> <span class="pn">]</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 29)" onmouseover="showTip(event, 'fs13', 29)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 30)" onmouseover="showTip(event, 'fs14', 30)" class="id">Zero</span><span class="pn">)</span><span class="pn">)</span><span class="pn">,</span>
                    <span onmouseout="hideTip(event, 'fs9', 31)" onmouseover="showTip(event, 'fs9', 31)" class="uc">None</span><span class="pn">,</span>
                    <span class="pn">[</span><span class="pn">]</span><span class="pn">,</span>
                    <span onmouseout="hideTip(event, 'fs9', 32)" onmouseover="showTip(event, 'fs9', 32)" class="uc">None</span><span class="pn">,</span>
                    <span onmouseout="hideTip(event, 'fs12', 33)" onmouseover="showTip(event, 'fs12', 33)" class="fn">SingleTextNode</span><span class="pn">(</span><span class="s">&quot;=&quot;</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 34)" onmouseover="showTip(event, 'fs13', 34)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 35)" onmouseover="showTip(event, 'fs14', 35)" class="id">Zero</span><span class="pn">)</span><span class="pn">,</span>
                    <span onmouseout="hideTip(event, 'fs19', 36)" onmouseover="showTip(event, 'fs19', 36)" class="rt">Expr</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs20', 37)" onmouseover="showTip(event, 'fs20', 37)" class="id">Constant</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs21', 38)" onmouseover="showTip(event, 'fs21', 38)" class="rt">Constant</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs22', 39)" onmouseover="showTip(event, 'fs22', 39)" class="id">FromText</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs12', 40)" onmouseover="showTip(event, 'fs12', 40)" class="fn">SingleTextNode</span><span class="pn">(</span><span class="s">&quot;0&quot;</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 41)" onmouseover="showTip(event, 'fs13', 41)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 42)" onmouseover="showTip(event, 'fs14', 42)" class="id">Zero</span><span class="pn">)</span><span class="pn">)</span><span class="pn">)</span><span class="pn">,</span>
                    <span onmouseout="hideTip(event, 'fs13', 43)" onmouseover="showTip(event, 'fs13', 43)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 44)" onmouseover="showTip(event, 'fs14', 44)" class="id">Zero</span>
                <span class="pn">)</span>
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 45)" onmouseover="showTip(event, 'fs23', 45)" class="rt">ModuleDecl</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs24', 46)" onmouseover="showTip(event, 'fs24', 46)" class="id">TopLevelBinding</span> <span class="pn">]</span><span class="pn">,</span>
              <span onmouseout="hideTip(event, 'fs13', 47)" onmouseover="showTip(event, 'fs13', 47)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 48)" onmouseover="showTip(event, 'fs14', 48)" class="id">Zero</span>
          <span class="pn">)</span> <span class="pn">]</span><span class="pn">,</span>
        <span onmouseout="hideTip(event, 'fs13', 49)" onmouseover="showTip(event, 'fs13', 49)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 50)" onmouseover="showTip(event, 'fs14', 50)" class="id">Zero</span>
    <span class="pn">)</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 51)" onmouseover="showTip(event, 'fs1', 51)" class="id">Fantomas</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs4', 52)" onmouseover="showTip(event, 'fs4', 52)" class="id">Core</span>

<span onmouseout="hideTip(event, 'fs25', 53)" onmouseover="showTip(event, 'fs25', 53)" class="rt">CodeFormatter</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs26', 54)" onmouseover="showTip(event, 'fs26', 54)" class="id">FormatOakAsync</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs6', 55)" onmouseover="showTip(event, 'fs6', 55)" class="id">implementationSyntaxTree</span><span class="pn">)</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs27', 56)" onmouseover="showTip(event, 'fs27', 56)" class="m">Async</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs28', 57)" onmouseover="showTip(event, 'fs28', 57)" class="id">RunSynchronously</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs29', 58)" onmouseover="showTip(event, 'fs29', 58)" class="fn">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span>
</code></pre>
<table class="pre"><tr><td><pre><code>let a = 0</code></pre></td></tr></table>
<p>Constructing the entire syntax tree can be a bit overwhelming at first. There is a lot of information to provide and a lot to unpack if you have never seen any of this before.</p>
<p>Let's deconstruct a couple of things:</p>
<ul>
<li><p>Every file has one or more <a href="../../reference/fantomas-core-syntaxoak-moduleornamespacenode.html">ModuleOrNamespaceNode</a>. In this case the module was anonymous and thus invisible.</p></li>
<li><p>Every <code>ModuleOrNamespaceNode</code> has top level <a href="../../reference/fantomas-core-syntaxoak-moduledecl.html">ModuleDecl</a>.</p></li>
<li><p><a href="../../https://fsprojects.github.io/fantomas/reference/fantomas-core-syntaxoak-moduledecl.html#TopLevelBinding">ModuleDecl.TopLevelBinding</a> takes a <a href="../../reference/fantomas-core-syntaxoak-bindingnode.html">BindingNode </a>.</p></li>
<li><p>The <code>functionName</code> of binding contains the name or is a pattern.</p></li>
<li><p>The <code>expr</code> (<a href="../../reference/fantomas-core-syntaxoak-expr.html">Expr</a>) represents the F# syntax expression.</p></li>
<li><p>Because there is no actual source code, all ranges will be <code>Range.Zero</code>.</p></li>
</ul>
<p>The more you interact with AST/Oak, the easier you pick up which node represents what.</p>
<h3><a name="Fantomas-FCS" class="anchor" href="#Fantomas-FCS">Fantomas.FCS</a></h3>
<p>When looking at the example, we notice that we've opened <code>Fantomas.FCS.Text</code>.<br />
<code>Fantomas.FCS</code> is a custom version of the F# compiler (built from source) that only exposes the F# parser and the syntax tree.<br />
The key difference is that <code>Fantomas.FCS</code> will most likely contain a more recent version of the F# parser.<br />
You can read the <a href="https://github.com/fsprojects/fantomas/blob/main/CHANGELOG.md">CHANGELOG</a> to see what git commit was used to build <code>Fantomas.FCS</code>.</p>
<p>You can use <code>Fantomas.FCS</code> in your own projects, but be aware that it is <strong>not binary compatible</strong> with <code>FSharp.Compiler.Service</code>.<br />
Example usage:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 59)" onmouseover="showTip(event, 'fs1', 59)" class="id">Fantomas</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs2', 60)" onmouseover="showTip(event, 'fs2', 60)" class="id">FCS</span>

<span onmouseout="hideTip(event, 'fs30', 61)" onmouseover="showTip(event, 'fs30', 61)" class="m">Parse</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs31', 62)" onmouseover="showTip(event, 'fs31', 62)" class="id">parseFile</span> <span class="k">false</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs32', 63)" onmouseover="showTip(event, 'fs32', 63)" class="m">SourceText</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs33', 64)" onmouseover="showTip(event, 'fs33', 64)" class="id">ofString</span> <span class="s">&quot;let a = 1&quot;</span><span class="pn">)</span> <span class="pn">[</span><span class="pn">]</span>
</code></pre>
<table class="pre"><tr><td><pre><code>(ImplFile
   (ParsedImplFileInput
      ("tmp.fsx", true, QualifiedNameOfFile Tmp$fsx, [], [],
       [SynModuleOrNamespace
          ([Tmp], false, AnonModule,
           [Let
              (false,
               [SynBinding
                  (None, Normal, false, false, [],
                   PreXmlDoc ((1,0), Fantomas.FCS.Xml.XmlDocCollector),
                   SynValData
                     (None, SynValInfo ([], SynArgInfo ([], false, None)), None),
                   Named (SynIdent (a, None), false, None, (1,4--1,5)), None,
                   Const (Int32 1, (1,8--1,9)), (1,4--1,5), Yes (1,0--1,9),
                   { LeadingKeyword = Let (1,0--1,3)
                     InlineKeyword = None
                     EqualsRange = Some (1,6--1,7) })], (1,0--1,9))],
           PreXmlDocEmpty, [], None, (1,0--1,9), { LeadingKeyword = None })],
       (false, false), { ConditionalDirectives = []
                         CodeComments = [] }, set [])), [])</code></pre></td></tr></table>
<p>You can format untyped AST created from <code>Fantomas.FCS</code> using the <code>CodeFormatter</code> API.<br />
However, we recommend to use the new <code>Oak</code> model (as in the example) instead.<br />
The <code>Oak</code> model is easier to reason with as it structures certain concepts differently than the untyped AST.</p>
<h2><a name="Tips-and-tricks" class="anchor" href="#Tips-and-tricks">Tips and tricks</a></h2>
<h3><a name="Online-tool" class="anchor" href="#Online-tool">Online tool</a></h3>
<p>The syntax tree can have an overwhelming type hierarchy.<br />
We wholeheartedly recommend to use our <strong><a href="https://fsprojects.github.io/fantomas-tools/#/ast">online tool</a></strong> when working with AST.</p>
<p><img src="../../images/oak-viewer.png" alt="F# AST Viewer" /></p>
<p>This shows you what Oak nodes the parser created for a given input text.<br />
From there on you can use our search bar to find the corresponding documentation:</p>
<p><img src="../../images/searchbar-ast.png" alt="Search bar" /></p>
<h3><a name="Match-the-AST-the-parser-would-produce" class="anchor" href="#Match-the-AST-the-parser-would-produce">Match the AST the parser would produce</a></h3>
<p>Fantomas will very selectively use information from the AST to construct the Oak.
Please make sure you construct the same Oak as Fantomas would.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// You typically make some helper functions along the way</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 65)" onmouseover="showTip(event, 'fs34', 65)" class="fn">text</span> <span onmouseout="hideTip(event, 'fs35', 66)" onmouseover="showTip(event, 'fs35', 66)" class="fn">v</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 67)" onmouseover="showTip(event, 'fs12', 67)" class="fn">SingleTextNode</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs35', 68)" onmouseover="showTip(event, 'fs35', 68)" class="fn">v</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 69)" onmouseover="showTip(event, 'fs13', 69)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 70)" onmouseover="showTip(event, 'fs14', 70)" class="id">Zero</span><span class="pn">)</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 71)" onmouseover="showTip(event, 'fs36', 71)" class="fn">mkCodeFromExpression</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs37', 72)" onmouseover="showTip(event, 'fs37', 72)" class="fn">e</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs19', 73)" onmouseover="showTip(event, 'fs19', 73)" class="rt">Expr</span><span class="pn">)</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs7', 74)" onmouseover="showTip(event, 'fs7', 74)" class="fn">Oak</span><span class="pn">(</span><span class="pn">[</span><span class="pn">]</span><span class="pn">,</span> <span class="pn">[</span> <span onmouseout="hideTip(event, 'fs8', 75)" onmouseover="showTip(event, 'fs8', 75)" class="fn">ModuleOrNamespaceNode</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs9', 76)" onmouseover="showTip(event, 'fs9', 76)" class="uc">None</span><span class="pn">,</span> <span class="pn">[</span> <span onmouseout="hideTip(event, 'fs23', 77)" onmouseover="showTip(event, 'fs23', 77)" class="rt">ModuleDecl</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs38', 78)" onmouseover="showTip(event, 'fs38', 78)" class="id">DeclExpr</span> <span onmouseout="hideTip(event, 'fs37', 79)" onmouseover="showTip(event, 'fs37', 79)" class="fn">e</span> <span class="pn">]</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 80)" onmouseover="showTip(event, 'fs13', 80)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 81)" onmouseover="showTip(event, 'fs14', 81)" class="id">Zero</span><span class="pn">)</span> <span class="pn">]</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 82)" onmouseover="showTip(event, 'fs13', 82)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 83)" onmouseover="showTip(event, 'fs14', 83)" class="id">Zero</span><span class="pn">)</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 84)" onmouseover="showTip(event, 'fs25', 84)" class="rt">CodeFormatter</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs26', 85)" onmouseover="showTip(event, 'fs26', 85)" class="id">FormatOakAsync</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs27', 86)" onmouseover="showTip(event, 'fs27', 86)" class="m">Async</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs28', 87)" onmouseover="showTip(event, 'fs28', 87)" class="id">RunSynchronously</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs29', 88)" onmouseover="showTip(event, 'fs29', 88)" class="fn">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs39', 89)" onmouseover="showTip(event, 'fs39', 89)" class="id">numberExpr</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 90)" onmouseover="showTip(event, 'fs19', 90)" class="rt">Expr</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs20', 91)" onmouseover="showTip(event, 'fs20', 91)" class="id">Constant</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs21', 92)" onmouseover="showTip(event, 'fs21', 92)" class="rt">Constant</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs22', 93)" onmouseover="showTip(event, 'fs22', 93)" class="id">FromText</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs34', 94)" onmouseover="showTip(event, 'fs34', 94)" class="fn">text</span> <span class="s">&quot;7&quot;</span><span class="pn">)</span><span class="pn">)</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs40', 95)" onmouseover="showTip(event, 'fs40', 95)" class="id">wrappedNumber</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs19', 96)" onmouseover="showTip(event, 'fs19', 96)" class="rt">Expr</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs41', 97)" onmouseover="showTip(event, 'fs41', 97)" class="id">Paren</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs42', 98)" onmouseover="showTip(event, 'fs42', 98)" class="fn">ExprParenNode</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs34', 99)" onmouseover="showTip(event, 'fs34', 99)" class="fn">text</span> <span class="s">&quot;(&quot;</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs39', 100)" onmouseover="showTip(event, 'fs39', 100)" class="id">numberExpr</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs34', 101)" onmouseover="showTip(event, 'fs34', 101)" class="fn">text</span> <span class="s">&quot;)&quot;</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 102)" onmouseover="showTip(event, 'fs13', 102)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 103)" onmouseover="showTip(event, 'fs14', 103)" class="id">Zero</span><span class="pn">)</span><span class="pn">)</span>

<span onmouseout="hideTip(event, 'fs36', 104)" onmouseover="showTip(event, 'fs36', 104)" class="fn">mkCodeFromExpression</span> <span onmouseout="hideTip(event, 'fs40', 105)" onmouseover="showTip(event, 'fs40', 105)" class="id">wrappedNumber</span>
</code></pre>
<table class="pre"><tr><td><pre><code>(7)</code></pre></td></tr></table>
<p>As a rule of thumb: <strong>create what the parser creates, use the online tool!</strong><br />
Just because you can create Oak nodes, does not mean Fantomas will do the right thing.</p>
<h3><a name="Look-at-the-Fantomas-code-base" class="anchor" href="#Look-at-the-Fantomas-code-base">Look at the Fantomas code base</a></h3>
<p>As mentioned, not every AST node is being used in Fantomas. There are numerous things that do not have any influence on the generation of code.<br />
For example creating <a href="../../reference/fsharp-compiler-syntax-synexpr.html#Lambda">SynExpr.Lambda</a>.</p>
<p>When you want to construct <code>fun a b -&gt; a + b</code>, the AST the online tool produces looks like:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Oak</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">0</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">16</span><span class="pn">)</span>
  <span class="id">ModuleOrNamespaceNode</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">0</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">16</span><span class="pn">)</span>
    <span class="id">ExprLambdaNode</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">0</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">16</span><span class="pn">)</span>
      <span class="s">&quot;fun&quot;</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">0</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">3</span><span class="pn">)</span>
      <span class="id">PatNamedNode</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">4</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">5</span><span class="pn">)</span>
        <span class="s">&quot;a&quot;</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">4</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">5</span><span class="pn">)</span>
      <span class="id">PatNamedNode</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">6</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">7</span><span class="pn">)</span>
        <span class="s">&quot;b&quot;</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">6</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">7</span><span class="pn">)</span>
      <span class="s">&quot;-&gt;&quot;</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">8</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">10</span><span class="pn">)</span>
      <span class="id">ExprInfixAppNode</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">11</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">16</span><span class="pn">)</span>
        <span class="s">&quot;a&quot;</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">11</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">12</span><span class="pn">)</span>
        <span class="s">&quot;+&quot;</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">13</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">14</span><span class="pn">)</span>
        <span class="s">&quot;b&quot;</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">15</span><span class="o">-</span><span class="n">1</span><span class="pn">,</span><span class="n">16</span><span class="pn">)</span>
</code></pre>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs43', 106)" onmouseover="showTip(event, 'fs43', 106)" class="id">lambdaExpr</span> <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 107)" onmouseover="showTip(event, 'fs44', 107)" class="fn">body</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs19', 108)" onmouseover="showTip(event, 'fs19', 108)" class="rt">Expr</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs45', 109)" onmouseover="showTip(event, 'fs45', 109)" class="fn">ExprInfixAppNode</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs19', 110)" onmouseover="showTip(event, 'fs19', 110)" class="rt">Expr</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs46', 111)" onmouseover="showTip(event, 'fs46', 111)" class="id">Ident</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs34', 112)" onmouseover="showTip(event, 'fs34', 112)" class="fn">text</span> <span class="s">&quot;a&quot;</span><span class="pn">)</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs34', 113)" onmouseover="showTip(event, 'fs34', 113)" class="fn">text</span> <span class="s">&quot;+&quot;</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs19', 114)" onmouseover="showTip(event, 'fs19', 114)" class="rt">Expr</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs46', 115)" onmouseover="showTip(event, 'fs46', 115)" class="id">Ident</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs34', 116)" onmouseover="showTip(event, 'fs34', 116)" class="fn">text</span> <span class="s">&quot;b&quot;</span><span class="pn">)</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 117)" onmouseover="showTip(event, 'fs13', 117)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 118)" onmouseover="showTip(event, 'fs14', 118)" class="id">Zero</span><span class="pn">)</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs19', 119)" onmouseover="showTip(event, 'fs19', 119)" class="rt">Expr</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs47', 120)" onmouseover="showTip(event, 'fs47', 120)" class="id">InfixApp</span>

    <span onmouseout="hideTip(event, 'fs48', 121)" onmouseover="showTip(event, 'fs48', 121)" class="fn">ExprLambdaNode</span><span class="pn">(</span>
        <span onmouseout="hideTip(event, 'fs34', 122)" onmouseover="showTip(event, 'fs34', 122)" class="fn">text</span> <span class="s">&quot;fun&quot;</span><span class="pn">,</span>
        <span class="pn">[</span> <span onmouseout="hideTip(event, 'fs49', 123)" onmouseover="showTip(event, 'fs49', 123)" class="rt">Pattern</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs50', 124)" onmouseover="showTip(event, 'fs50', 124)" class="id">Named</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs51', 125)" onmouseover="showTip(event, 'fs51', 125)" class="fn">PatNamedNode</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs9', 126)" onmouseover="showTip(event, 'fs9', 126)" class="uc">None</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs34', 127)" onmouseover="showTip(event, 'fs34', 127)" class="fn">text</span> <span class="s">&quot;a&quot;</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 128)" onmouseover="showTip(event, 'fs13', 128)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 129)" onmouseover="showTip(event, 'fs14', 129)" class="id">Zero</span><span class="pn">)</span><span class="pn">)</span>
          <span onmouseout="hideTip(event, 'fs49', 130)" onmouseover="showTip(event, 'fs49', 130)" class="rt">Pattern</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs50', 131)" onmouseover="showTip(event, 'fs50', 131)" class="id">Named</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs51', 132)" onmouseover="showTip(event, 'fs51', 132)" class="fn">PatNamedNode</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs9', 133)" onmouseover="showTip(event, 'fs9', 133)" class="uc">None</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs34', 134)" onmouseover="showTip(event, 'fs34', 134)" class="fn">text</span> <span class="s">&quot;b&quot;</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs13', 135)" onmouseover="showTip(event, 'fs13', 135)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 136)" onmouseover="showTip(event, 'fs14', 136)" class="id">Zero</span><span class="pn">)</span><span class="pn">)</span> <span class="pn">]</span><span class="pn">,</span>
        <span onmouseout="hideTip(event, 'fs34', 137)" onmouseover="showTip(event, 'fs34', 137)" class="fn">text</span> <span class="s">&quot;-&gt;&quot;</span><span class="pn">,</span>
        <span onmouseout="hideTip(event, 'fs44', 138)" onmouseover="showTip(event, 'fs44', 138)" class="fn">body</span><span class="pn">,</span>
        <span onmouseout="hideTip(event, 'fs13', 139)" onmouseover="showTip(event, 'fs13', 139)" class="m">Range</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs14', 140)" onmouseover="showTip(event, 'fs14', 140)" class="id">Zero</span>
    <span class="pn">)</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs19', 141)" onmouseover="showTip(event, 'fs19', 141)" class="rt">Expr</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs52', 142)" onmouseover="showTip(event, 'fs52', 142)" class="id">Lambda</span>

<span onmouseout="hideTip(event, 'fs36', 143)" onmouseover="showTip(event, 'fs36', 143)" class="fn">mkCodeFromExpression</span> <span onmouseout="hideTip(event, 'fs43', 144)" onmouseover="showTip(event, 'fs43', 144)" class="id">lambdaExpr</span>
</code></pre>
<table class="pre"><tr><td><pre><code>fun a b -&gt; a + b</code></pre></td></tr></table>
<p>How to know which nodes to include? Take a look at <code>CodePrinter.fs</code>!</p>
<h3><a name="Create-your-own-set-of-helper-functions" class="anchor" href="#Create-your-own-set-of-helper-functions">Create your own set of helper functions</a></h3>
<p>Throughout all these examples, we have duplicated a lot of code. You can typically easily refactor this into some helper functions.<br />
The Fantomas maintainers are not affiliated with any projects that expose AST construction helpers.</p>
<h3><a name="Updates" class="anchor" href="#Updates">Updates</a></h3>
<p>Since code generation is considered to be a nice to have functionality, there is no compatibility between any <code>Fantomas.Core</code> version when it comes to the <code>SyntaxOak</code> module.<br />
We do not apply any semantic versioning to <code>Fantomas.FCS</code> or <code>Fantomas.Core.SyntaxOak</code>. Breaking changes can be expected at any given point.<br />
Our recommendation is that you include a set of regression tests  to meet your own expectations when upgrading.<br />
As none of our versions are compatible it is advised to take a very strict dependency on <code>Fantomas.Core</code>. Using constraints like <code>(&gt;= 6.0.0)</code> will inevitably lead to unexpected problems.</p>
<fantomas-nav previous="VSCode.html" next="UpgradeGuide.html"></fantomas-nav>

        <div class="fsdocs-tip" id="fs1">namespace Fantomas</div>
<div class="fsdocs-tip" id="fs2">namespace Fantomas.FCS</div>
<div class="fsdocs-tip" id="fs3">namespace Fantomas.FCS.Text</div>
<div class="fsdocs-tip" id="fs4">namespace Fantomas.Core</div>
<div class="fsdocs-tip" id="fs5">module SyntaxOak

from Fantomas.Core</div>
<div class="fsdocs-tip" id="fs6">val implementationSyntaxTree: Oak</div>
<div class="fsdocs-tip" id="fs7">Multiple items<br />type Oak =
  inherit NodeBase
  new: parsedHashDirectives: ParsedHashDirectiveNode list * modulesOrNamespaces: ModuleOrNamespaceNode list * m: range -&gt; Oak
  override Children: Node array
  member ModulesOrNamespaces: ModuleOrNamespaceNode list
  member ParsedHashDirectives: ParsedHashDirectiveNode list<br /><br />--------------------<br />new: parsedHashDirectives: ParsedHashDirectiveNode list * modulesOrNamespaces: ModuleOrNamespaceNode list * m: range -&gt; Oak</div>
<div class="fsdocs-tip" id="fs8">Multiple items<br />type ModuleOrNamespaceNode =
  inherit NodeBase
  new: header: ModuleOrNamespaceHeaderNode option * decls: ModuleDecl list * range: range -&gt; ModuleOrNamespaceNode
  override Children: Node array
  member Declarations: ModuleDecl list
  member Header: ModuleOrNamespaceHeaderNode option
  member IsNamed: bool<br /><br />--------------------<br />new: header: ModuleOrNamespaceHeaderNode option * decls: ModuleDecl list * range: range -&gt; ModuleOrNamespaceNode</div>
<div class="fsdocs-tip" id="fs9">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="fsdocs-tip" id="fs10">Multiple items<br />type BindingNode =
  inherit NodeBase
  new: xmlDoc: XmlDocNode option * attributes: MultipleAttributeListNode option * leadingKeyword: MultipleTextsNode * isMutable: bool * inlineNode: SingleTextNode option * accessibility: SingleTextNode option * functionName: Choice&lt;IdentListNode,Pattern&gt; * genericTypeParameters: TyparDecls option * parameters: Pattern list * returnType: BindingReturnInfoNode option * equals: SingleTextNode * expr: Expr * range: range -&gt; BindingNode
  member Accessibility: SingleTextNode option
  member Attributes: MultipleAttributeListNode option
  override Children: Node array
  member Equals: SingleTextNode
  member Expr: Expr
  member FunctionName: Choice&lt;IdentListNode,Pattern&gt;
  member GenericTypeParameters: TyparDecls option
  member Inline: SingleTextNode option
  ...<br /><br />--------------------<br />new: xmlDoc: XmlDocNode option * attributes: MultipleAttributeListNode option * leadingKeyword: MultipleTextsNode * isMutable: bool * inlineNode: SingleTextNode option * accessibility: SingleTextNode option * functionName: Choice&lt;IdentListNode,Pattern&gt; * genericTypeParameters: TyparDecls option * parameters: Pattern list * returnType: BindingReturnInfoNode option * equals: SingleTextNode * expr: Expr * range: range -&gt; BindingNode</div>
<div class="fsdocs-tip" id="fs11">Multiple items<br />type MultipleTextsNode =
  inherit NodeBase
  new: content: SingleTextNode list * range: range -&gt; MultipleTextsNode
  override Children: Node array
  member Content: SingleTextNode list<br /><br />--------------------<br />new: content: SingleTextNode list * range: range -&gt; MultipleTextsNode</div>
<div class="fsdocs-tip" id="fs12">Multiple items<br />type SingleTextNode =
  inherit NodeBase
  new: idText: string * range: range -&gt; SingleTextNode
  override Children: Node array
  member Text: string<br /><br />--------------------<br />new: idText: string * range: range -&gt; SingleTextNode</div>
<div class="fsdocs-tip" id="fs13">Multiple items<br />module Range

from Fantomas.FCS.Text<br /><br />--------------------<br />[&lt;Struct&gt;]
type Range =
  member End: pos
  member EndColumn: int
  member EndLine: int
  member EndRange: range
  member FileName: string
  member IsSynthetic: bool
  member Start: pos
  member StartColumn: int
  member StartLine: int
  member StartRange: range
  ...<br /><em>&lt;summary&gt;
 Represents a range within a file
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs14">property Range.Zero: range with get<br /><em>&lt;summary&gt;
 The range where all values are zero
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs15">union case Choice.Choice1Of2: &#39;T1 -&gt; Choice&lt;&#39;T1,&#39;T2&gt;</div>
<div class="fsdocs-tip" id="fs16">Multiple items<br />type IdentListNode =
  inherit NodeBase
  new: content: IdentifierOrDot list * range: range -&gt; IdentListNode
  override Children: Node array
  member Content: IdentifierOrDot list
  member IsEmpty: bool
  static member Empty: IdentListNode<br /><br />--------------------<br />new: content: IdentifierOrDot list * range: range -&gt; IdentListNode</div>
<div class="fsdocs-tip" id="fs17">type IdentifierOrDot =
  | Ident of SingleTextNode
  | KnownDot of SingleTextNode
  | UnknownDot
  member Equals: IdentifierOrDot * IEqualityComparer -&gt; bool
  member Range: range option</div>
<div class="fsdocs-tip" id="fs18">union case IdentifierOrDot.Ident: SingleTextNode -&gt; IdentifierOrDot</div>
<div class="fsdocs-tip" id="fs19">type Expr =
  | Lazy of ExprLazyNode
  | Single of ExprSingleNode
  | Constant of Constant
  | Null of SingleTextNode
  | Quote of ExprQuoteNode
  | Typed of ExprTypedNode
  | New of ExprNewNode
  | Tuple of ExprTupleNode
  | StructTuple of ExprStructTupleNode
  | ArrayOrList of ExprArrayOrListNode
  ...
  static member Node: x: Expr -&gt; Node
  member HasParentheses: bool</div>
<div class="fsdocs-tip" id="fs20">union case Expr.Constant: Constant -&gt; Expr</div>
<div class="fsdocs-tip" id="fs21">type Constant =
  | FromText of SingleTextNode
  | Unit of UnitNode
  | Measure of ConstantMeasureNode
  static member Node: c: Constant -&gt; NodeBase</div>
<div class="fsdocs-tip" id="fs22">union case Constant.FromText: SingleTextNode -&gt; Constant</div>
<div class="fsdocs-tip" id="fs23">type ModuleDecl =
  | OpenList of OpenListNode
  | HashDirectiveList of HashDirectiveListNode
  | Attributes of ModuleDeclAttributesNode
  | DeclExpr of Expr
  | Exception of ExceptionDefnNode
  | ExternBinding of ExternBindingNode
  | TopLevelBinding of BindingNode
  | ModuleAbbrev of ModuleAbbrevNode
  | NestedModule of NestedModuleNode
  | TypeDefn of TypeDefn
  ...
  static member Node: x: ModuleDecl -&gt; Node<br /><em>&lt;summary&gt;
 Each case in this DU should have a container node
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs24">union case ModuleDecl.TopLevelBinding: BindingNode -&gt; ModuleDecl</div>
<div class="fsdocs-tip" id="fs25">type CodeFormatter =
  static member FormatASTAsync: ast: ParsedInput -&gt; Async&lt;string&gt; + 2 overloads
  static member FormatDocumentAsync: isSignature: bool * source: string -&gt; Async&lt;FormatResult&gt; + 2 overloads
  static member FormatOakAsync: oak: Oak -&gt; Async&lt;string&gt; + 1 overload
  static member FormatSelectionAsync: isSignature: bool * source: string * selection: range -&gt; Async&lt;string * range&gt; + 1 overload
  static member GetVersion: unit -&gt; string
  static member IsValidFSharpCodeAsync: isSignature: bool * source: string -&gt; Async&lt;bool&gt;
  static member MakePosition: line: int * column: int -&gt; pos
  static member MakeRange: fileName: string * startLine: int * startCol: int * endLine: int * endCol: int -&gt; range
  static member ParseAsync: isSignature: bool * source: string -&gt; Async&lt;(ParsedInput * string list) array&gt;
  static member ParseOakAsync: isSignature: bool * source: string -&gt; Async&lt;(Oak * string list) array&gt;
  ...</div>
<div class="fsdocs-tip" id="fs26">static member CodeFormatter.FormatOakAsync: oak: Oak -&gt; Async&lt;string&gt;<br />static member CodeFormatter.FormatOakAsync: oak: Oak * config: FormatConfig -&gt; Async&lt;string&gt;</div>
<div class="fsdocs-tip" id="fs27">Multiple items<br />module Async

from Fantomas.Core<br /><br />--------------------<br />type Async =
  static member AsBeginEnd: computation: (&#39;Arg -&gt; Async&lt;&#39;T&gt;) -&gt; (&#39;Arg * AsyncCallback * obj -&gt; IAsyncResult) * (IAsyncResult -&gt; &#39;T) * (IAsyncResult -&gt; unit)
  static member AwaitEvent: event: IEvent&lt;&#39;Del,&#39;T&gt; * ?cancelAction: (unit -&gt; unit) -&gt; Async&lt;&#39;T&gt; (requires delegate and &#39;Del :&gt; Delegate)
  static member AwaitIAsyncResult: iar: IAsyncResult * ?millisecondsTimeout: int -&gt; Async&lt;bool&gt;
  static member AwaitTask: task: Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt; + 1 overload
  static member AwaitWaitHandle: waitHandle: WaitHandle * ?millisecondsTimeout: int -&gt; Async&lt;bool&gt;
  static member CancelDefaultToken: unit -&gt; unit
  static member Catch: computation: Async&lt;&#39;T&gt; -&gt; Async&lt;Choice&lt;&#39;T,exn&gt;&gt;
  static member Choice: computations: Async&lt;&#39;T option&gt; seq -&gt; Async&lt;&#39;T option&gt;
  static member FromBeginEnd: beginAction: (AsyncCallback * obj -&gt; IAsyncResult) * endAction: (IAsyncResult -&gt; &#39;T) * ?cancelAction: (unit -&gt; unit) -&gt; Async&lt;&#39;T&gt; + 3 overloads
  static member FromContinuations: callback: ((&#39;T -&gt; unit) * (exn -&gt; unit) * (OperationCanceledException -&gt; unit) -&gt; unit) -&gt; Async&lt;&#39;T&gt;
  ...<br /><br />--------------------<br />type Async&lt;&#39;T&gt;</div>
<div class="fsdocs-tip" id="fs28">static member Async.RunSynchronously: computation: Async&lt;&#39;T&gt; * ?timeout: int * ?cancellationToken: System.Threading.CancellationToken -&gt; &#39;T</div>
<div class="fsdocs-tip" id="fs29">val printfn: format: Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T</div>
<div class="fsdocs-tip" id="fs30">module Parse

from Fantomas.FCS</div>
<div class="fsdocs-tip" id="fs31">val parseFile: isSignature: bool -&gt; sourceText: ISourceText -&gt; defines: string list -&gt; Syntax.ParsedInput * Parse.FSharpParserDiagnostic list</div>
<div class="fsdocs-tip" id="fs32">module SourceText

from Fantomas.FCS.Text<br /><em>&lt;summary&gt;
 Functions related to ISourceText objects
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs33">val ofString: string -&gt; ISourceText<br /><em>&lt;summary&gt;
 Creates an ISourceText object from the given string
&lt;/summary&gt;</em></div>
<div class="fsdocs-tip" id="fs34">val text: v: string -&gt; SingleTextNode</div>
<div class="fsdocs-tip" id="fs35">val v: string</div>
<div class="fsdocs-tip" id="fs36">val mkCodeFromExpression: e: Expr -&gt; unit</div>
<div class="fsdocs-tip" id="fs37">val e: Expr</div>
<div class="fsdocs-tip" id="fs38">union case ModuleDecl.DeclExpr: Expr -&gt; ModuleDecl</div>
<div class="fsdocs-tip" id="fs39">val numberExpr: Expr</div>
<div class="fsdocs-tip" id="fs40">val wrappedNumber: Expr</div>
<div class="fsdocs-tip" id="fs41">union case Expr.Paren: ExprParenNode -&gt; Expr</div>
<div class="fsdocs-tip" id="fs42">Multiple items<br />type ExprParenNode =
  inherit NodeBase
  new: openingParen: SingleTextNode * expr: Expr * closingParen: SingleTextNode * range: range -&gt; ExprParenNode
  override Children: Node array
  member ClosingParen: SingleTextNode
  member Expr: Expr
  member OpeningParen: SingleTextNode<br /><br />--------------------<br />new: openingParen: SingleTextNode * expr: Expr * closingParen: SingleTextNode * range: range -&gt; ExprParenNode</div>
<div class="fsdocs-tip" id="fs43">val lambdaExpr: Expr</div>
<div class="fsdocs-tip" id="fs44">val body: Expr</div>
<div class="fsdocs-tip" id="fs45">Multiple items<br />type ExprInfixAppNode =
  inherit NodeBase
  interface InfixApp
  new: lhs: Expr * operator: SingleTextNode * rhs: Expr * range: range -&gt; ExprInfixAppNode
  override Children: Node array
  member LeftHandSide: Expr
  member Operator: SingleTextNode
  member RightHandSide: Expr<br /><br />--------------------<br />new: lhs: Expr * operator: SingleTextNode * rhs: Expr * range: range -&gt; ExprInfixAppNode</div>
<div class="fsdocs-tip" id="fs46">union case Expr.Ident: SingleTextNode -&gt; Expr</div>
<div class="fsdocs-tip" id="fs47">union case Expr.InfixApp: ExprInfixAppNode -&gt; Expr</div>
<div class="fsdocs-tip" id="fs48">Multiple items<br />type ExprLambdaNode =
  inherit NodeBase
  new: funNode: SingleTextNode * parameters: Pattern list * arrow: SingleTextNode * expr: Expr * range: range -&gt; ExprLambdaNode
  member Arrow: SingleTextNode
  override Children: Node array
  member Expr: Expr
  member Fun: SingleTextNode
  member Parameters: Pattern list<br /><br />--------------------<br />new: funNode: SingleTextNode * parameters: Pattern list * arrow: SingleTextNode * expr: Expr * range: range -&gt; ExprLambdaNode</div>
<div class="fsdocs-tip" id="fs49">type Pattern =
  | OptionalVal of SingleTextNode
  | Or of PatLeftMiddleRight
  | Ands of PatAndsNode
  | Null of SingleTextNode
  | Wild of SingleTextNode
  | Parameter of PatParameterNode
  | NamedParenStarIdent of PatNamedParenStarIdentNode
  | Named of PatNamedNode
  | As of PatLeftMiddleRight
  | ListCons of PatLeftMiddleRight
  ...
  static member Node: x: Pattern -&gt; Node</div>
<div class="fsdocs-tip" id="fs50">union case Pattern.Named: PatNamedNode -&gt; Pattern</div>
<div class="fsdocs-tip" id="fs51">Multiple items<br />type PatNamedNode =
  inherit NodeBase
  new: accessibility: SingleTextNode option * name: SingleTextNode * range: range -&gt; PatNamedNode
  member Accessibility: SingleTextNode option
  override Children: Node array
  member Name: SingleTextNode<br /><br />--------------------<br />new: accessibility: SingleTextNode option * name: SingleTextNode * range: range -&gt; PatNamedNode</div>
<div class="fsdocs-tip" id="fs52">union case Expr.Lambda: ExprLambdaNode -&gt; Expr</div>

    </div>
</main>
<aside id="fsdocs-page-menu">
    <p id="on-this-page">On this page</p>
    <ul>
  <li class="level-1">
    <a href="#Generating-source-code">
      Generating source code
    </a>
  </li>
  <li class="level-2">
    <a href="#Key-motivation">
      Key motivation
    </a>
  </li>
  <li class="level-2">
    <a href="#Consider-using-Fabulous-AST">
      Consider using Fabulous.AST
    </a>
  </li>
  <li class="level-2">
    <a href="#Generating-source-code-from-scratch">
      Generating source code from scratch
    </a>
  </li>
  <li class="level-3">
    <a href="#Example-syntax-tree">
      Example syntax tree
    </a>
  </li>
  <li class="level-3">
    <a href="#Fantomas-FCS">
      Fantomas.FCS
    </a>
  </li>
  <li class="level-2">
    <a href="#Tips-and-tricks">
      Tips and tricks
    </a>
  </li>
  <li class="level-3">
    <a href="#Online-tool">
      Online tool
    </a>
  </li>
  <li class="level-3">
    <a href="#Match-the-AST-the-parser-would-produce">
      Match the AST the parser would produce
    </a>
  </li>
  <li class="level-3">
    <a href="#Look-at-the-Fantomas-code-base">
      Look at the Fantomas code base
    </a>
  </li>
  <li class="level-3">
    <a href="#Create-your-own-set-of-helper-functions">
      Create your own set of helper functions
    </a>
  </li>
  <li class="level-3">
    <a href="#Updates">
      Updates
    </a>
  </li>
</ul>
</aside>
<dialog>
    <input type="search" placeholder="Search docs" />
    <div class="results">
        <ul></ul>
        <p class="empty">Type something to start searching.</p>
    </div>
</dialog>
<script type="module" src="https://fsprojects.github.io/fantomas/content/fsdocs-tips.js"></script>
<script type="module" src="https://fsprojects.github.io/fantomas/content/fsdocs-theme-toggle.js"></script>
<script type="module" src="https://fsprojects.github.io/fantomas/content/fsdocs-details-toggle.js"></script>
<script type="module" src="https://fsprojects.github.io/fantomas/content/fsdocs-theme.js"></script>
<script type="module" src="https://fsprojects.github.io/fantomas/content/fsdocs-search.js"></script>
<script type="module">
    import mermaid from "https://esm.sh/mermaid@9.2.2";
    mermaid.initialize({
        startOnLoad: true,
        theme: "base",
        themeVariables: {
            primaryColor: '#338cbb',
            primaryTextColor: '#FFF',
            primaryBorderColor: '#5aacd6'
        }
    });

    const menuHeaders = [...document.querySelectorAll(".nav-header")].filter(nh => nh.id);
    menuHeaders.forEach(nv => {
        nv.addEventListener("click", () => {
            nv.classList.toggle("active");
        })
    })
</script>
<script type="module" src="https://fsprojects.github.io/fantomas/content/webcomponents.js"></script>
</body>
</html>