<!DOCTYPE html>
<html lang="en" data-root="https://fsprojects.github.io/fantomas/">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Florian Verdonck, Jindřich Ivánek, David Schaefer">
  <title>Fantomas.Core overview (1)
</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;1,400&family=Reem+Kufi:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
  <link rel="shortcut icon" type="image/x-icon" href="https://fsprojects.github.io/fantomas/images/favicon.ico">
  <link type="text/css" rel="stylesheet" href="https://fsprojects.github.io/fantomas/content/fsdocs-custom.css" />
  <script type="text/javascript" src="https://fsprojects.github.io/fantomas/content/fsdocs-tips.js"></script>
  <!-- BEGIN SEARCH BOX: this adds support for the search box -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
  <!-- END SEARCH BOX: this adds support for the search box -->
  
</head>

<body>
     <aside class="bg-primary h-100 fs-5">
      <div id="sidebar-header" class="d-flex justify-content-end mt-1">
      <button class="btn d-md-none" id="close-mobile-menu" aria-controls="sidebar-wrapper" aria-expanded="false" aria-label="Toggle navigation">
        <i class="sidebar-toggle fs-3 bi bi-x-lg"></i>
                  </button>
              </div>
      <div id="sidebar-logo" class="d-flex justify-content-center p-5">
        <a href="https://fsprojects.github.io/fantomas/docs/index.html" ><img id="fsdocs-logo" src="https://fsprojects.github.io/fantomas//images/logo-fantomas-white.svg" /></a>
      </div>
      <div id="sidebar-content" class="accordion accordion-flush ps-0 text-white fs-6">
        <div id="end-users-wrapper" class="accordion-item">
    <li class="docs-menu">
        <button id="end-users-button"
            class="accordion-button collapsed btn text-white d-flex justify-content-between align-items-center"
            data-bs-toggle="collapse" data-bs-target="#end-users" aria-expanded="false"
            aria-control="end-users" type="button">
            End-users
        </button>
        <div id="end-users" class="accordion-collapse collapse ps-4 pb-2 " data-bs-parent="#sidebar-content">
            <ul class="list-unstyled fw-normal mb-0">
                <li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/GettingStarted.html" class="nav-link pb-2 d-block" > Getting Started
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/StyleGuide.html" class="nav-link pb-2 d-block" > Style guide
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/Configuration.html" class="nav-link pb-2 d-block" > Configuration
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/IgnoreFiles.html" class="nav-link pb-2 d-block" > Ignore Files
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/FormattingCheck.html" class="nav-link pb-2 d-block" > Formatting Check
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/GitHooks.html" class="nav-link pb-2 d-block" > Git hooks
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/Rider.html" class="nav-link pb-2 d-block" > JetBrains Rider
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/VisualStudio.html" class="nav-link pb-2 d-block" > Visual Studio
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/VSCode.html" class="nav-link pb-2 d-block" > Visual Studio Code
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/GeneratingCode.html" class="nav-link pb-2 d-block" > Generating source code
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/UpgradeGuide.html" class="nav-link pb-2 d-block" > Upgrade guide
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/end-users/FAQ.html" class="nav-link pb-2 d-block" > FAQ
</a></li>

            </ul>
        </div>
    </li>
</div>
<div id="contributors-wrapper" class="accordion-item">
    <li class="docs-menu">
        <button id="contributors-button"
            class="accordion-button collapsed btn text-white d-flex justify-content-between align-items-center"
            data-bs-toggle="collapse" data-bs-target="#contributors" aria-expanded="false"
            aria-control="contributors" type="button">
            Contributors
        </button>
        <div id="contributors" class="accordion-collapse collapse ps-4 pb-2 " data-bs-parent="#sidebar-content">
            <ul class="list-unstyled fw-normal mb-0">
                <li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Index.html" class="nav-link pb-2 d-block" > Contributors
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/FSharp.html" class="nav-link pb-2 d-block" > F#
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Getting Started.html" class="nav-link pb-2 d-block" > Getting started
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Solution Structure.html" class="nav-link pb-2 d-block" > Solution structure
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Transforming.html" class="nav-link pb-2 d-block" > Fantomas.Core overview (1)
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Traverse.html" class="nav-link pb-2 d-block" > Fantomas.Core overview (2)
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Formatted Code.html" class="nav-link pb-2 d-block" > Fantomas.Core overview (3)
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Conditional Compilation Directives.html" class="nav-link pb-2 d-block" > Formatting Conditional Compilation Directives
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/How Can I Contribute.html" class="nav-link pb-2 d-block" > How can I contribute?
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/The Missing Comment.html" class="nav-link pb-2 d-block" > The Missing Comment
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Multiple Times.html" class="nav-link pb-2 d-block" > Fantomas is trying to format the input multiple times due to the detection of multiple defines
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Pull request ground rules.html" class="nav-link pb-2 d-block" > Pull request ground rules
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Updating the compiler.html" class="nav-link pb-2 d-block" > Updating the compiler sources
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Releases.html" class="nav-link pb-2 d-block" > Releases
</a></li>

<li class="nav-item"><a href="https://fsprojects.github.io/fantomas/docs/contributors/Glossary.html" class="nav-link pb-2 d-block" > Glossary
</a></li>

            </ul>
        </div>
    </li>
</div>
        <div id="api_reference-wrapper" class="accordion-item">
    <li class="docs-menu">
        <button id="api_reference-button"
            class="accordion-button collapsed btn text-white d-flex justify-content-between align-items-center"
            data-bs-toggle="collapse" data-bs-target="#api_reference" aria-expanded="false"
            aria-control="api_reference" type="button">
            API Reference
        </button>
        <div id="api_reference" class="accordion-collapse collapse ps-4 pb-2 " data-bs-parent="#sidebar-content">
            <ul class="list-unstyled fw-normal mb-0">
                <li class="nav-item"><a href="https://fsprojects.github.io/fantomas/reference/index.html" class="nav-link pb-2 d-block" > All Namespaces</a></li>

            </ul>
        </div>
    </li>
</div>
      </div>
    </aside>
    <main class="doc-content">
     <nav class="navbar navbar-expand-sm border py-1">
        <div class="container-fluid flex-nowrap">
          <button class="btn" id="toggle-mobile-menu" aria-expanded="false" aria-label="Toggle navigation">
            <i class="sidebar-toggle fs-3 bi bi-list"></i>
          </button>
          <div id="mobile-navbar" class="container-fluid d-flex justify-content-between d-sm-none">
            <i class="invisible bi bi-github fs-3 align-self-end"></i>
         <a href="./index.html" ><img id="fsdocs-logo-mobile" width="32" height="32" src="https://fsprojects.github.io/fantomas//images/logo.png" /></a>
            <a class="nav-link m-0 p-0" target="_blank" href="https://github.com/fsprojects/fantomas/"> <i class="bi bi-github fs-3 align-self-end"></i>
</a>
          </div>
          <div class="collapse navbar-collapse" id="navbarText">
            <div class="navbar-nav me-auto mb-2 mb-lg-0 fs-5">
                <a class="nav-link active" aria-current="page" href="https://fsprojects.github.io/fantomas/docs/index.html">Docs</a>
                <a class="nav-link" target="_blank" href="https://fsprojects.github.io/fantomas-tools/">Tools</a>
            </div>
            <form class="d-flex">
              <div class="input-group me-4">
              <label for="search-by">
                <i class="fas fa-search"></i>
              </label>
                <div class="btn border-end-0 border">
                  <i class="bi bi-search"></i>
                </div>
                <input aria-label="Search" class="form-control  border-start-0 border" data-search-input=""
                  id="search-by" type="search" placeholder="Search..." />
                <span class="input-group-append">
                </span>
                <span data-search-clear="">
                  <i class="fas fa-times"></i>
                </span>
              </div>
            </form>
            <a class="nav-link m-0 p-0" target="_blank" href="https://github.com/fsprojects/fantomas/">GitHub<i
                class="bi bi-box-arrow-up-right mx-2"></i></a>
          </div>
        </div>
      </nav>
      <div id="fsdocs-content" class="bg-white m-2 m-sm-5 p-3 p-sm-4">
        
<h1><a name="Fantomas-Core-overview-1" class="anchor" href="#Fantomas-Core-overview-1">Fantomas.Core overview (1)</a></h1>
<p>In its simplest form, Fantomas.Core works in two major phases: transform the raw source code to a custom tree model and traverse that custom tree to print the formatted code.</p>
<div class="mermaid text-center">
graph TD
    A[Transform source code to Oak] --> B
    B[Traverse Oak to get formatted code] --> C[Formatted code]
    style A stroke:#338CBB,stroke-width:2px
 </div>
<p>Unfortunately, both phases are not always very straight forward.<br />
But once you get hang of the first phase, you can easily understand the second phase.</p>
<h2><a name="Processing-the-raw-source" class="anchor" href="#Processing-the-raw-source">Processing the raw source</a></h2>
<p>To have an understanding of what the raw source code means we parse the code using the parser of the F# compiler.<br />
We can parse the source code into an untyped syntax tree. This tree isn't really perfect for our use-case, so we map it to an <code>Oak</code>.<br />
An <code>Oak</code> is the toplevel root node of the Fantomas tree. We use a custom tree because it better suites our needs to reconstruct the output code.</p>
<div class="mermaid text-center">
graph TD
    A[Parse AST] --> B
    B[Transfrom untyped AST to OAK] --> C
    C[Enrich the Oak with Trivia]
</div>
<h3><a name="Parse-AST" class="anchor" href="#Parse-AST">Parse AST</a></h3>
<p>Parsing the AST is straightforward. We use the <code>parseFile</code> function from <code>Fantomas.FCS</code> and get back a syntax tree and diagnostic information.<br />
The diagnostic information is used to report errors and warnings. When we have errors, we stop processing the file.</p>
<p><strong>Fantomas requires a valid source code to format.</strong></p>
<p>If your code has errors, the parser cannot return a complete AST which is a strict requirement to run the remaining phases.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">a</span> <span class="o">=</span>
</code></pre>
<p>Returns a parsing error <code>Incomplete structured construct at or before this point in binding</code>.
This has <code>FSharpDiagnosticSeverity.Error</code> and Fantomas will not process any code that has those.</p>
<p>When there are only warnings, Fantomas will still try to process the file but will always yield a result.</p>
<p><code>parseFile</code> takes three parameters:
- <code>isSignature: bool</code></p>
<p>The Syntax tree for a signature is a little different than a regular source file. The parser needs to know this and throughout the rest of the process, signature ASTs are treated differently.</p>
<ul>
<li><code>sourceText: ISourceText</code></li>
</ul>
<p>The input source code string is converted to an <a href="https://fsprojects.github.io/fantomas/reference/fsharp-compiler-text-isourcetext.html">ISourceText</a>) internally.</p>
<ul>
<li><code>defines: string list</code></li>
</ul>
<p>Conditional compilation defines are passed to the parser. These can have an influence on the parsing process, resulting in different ASTs.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="fn">a</span> <span class="o">=</span>
    <span class="pp">#if</span> <span class="id">DEBUG</span>
<span class="inactive">    </span><span class="inactive">0</span>
    <span class="pp">#else</span>
    <span class="n">1</span>
    <span class="pp">#endif</span>
</code></pre>
<p>Depending on the defines <code>[]</code> or <code>["DEBUG"]</code>, the AST will be different.
The tree will also be created based on a single code path.</p>
<h3><a name="Transform-untyped-AST-to-Oak" class="anchor" href="#Transform-untyped-AST-to-Oak">Transform untyped AST to Oak</a></h3>
<p>The untyped syntax tree from the F# compiler is used as an intermediate representation of source code in the process of transforming a text file to binary.<br />
The AST is optimized for the use-case of generating binary. What we try to do in Fantomas is stop at the first AST level and go back to source text.</p>
<p>The F# compiler was never designed with our use-case in mind and yet it has served us very well for years.
In the past we did not have our own tree and were able to pull of formatting by traversing the compiler tree.
This of course had its limitations and we had to overcome these with some hacks.</p>
<p>Alas, some things in the AST aren't shaped the way we would like them to be. Sometimes, there is too much information, other times to little.
To stream line our entire process, we've decided to map the untyped tree to our own custom object model.
This introduces a lot of flexibility and simplifies our story.</p>
<blockquote>
<p>I thought Fangorn was dangerous - Gimli, son of Glóin</p>
</blockquote>
<p>In <code>ASTTransformer.fs</code> we map the AST to our tree model. Some of the benefits we get out of this:</p>
<ul>
<li>The Oak model does not differentiate between implementation files and signature files. We use one tree model which allows for optimal code re-use in <code>CodePrinter.fs</code>.</li>
<li>
We don't map all possible combinations of AST into our model. Sometimes valid AST code can in theory be created, 
but will in practise never exist. For example <a href="../../reference/fsharp-compiler-syntax-syntypedefnrepr.html#Exception">SynTypeDefnRepr.Exception</a>. It is defined in <code>SyntaxTree.fs</code> yet the parser (<code>pars.fs</code>) will never create it.
The F# compiler uses this later in the typed tree. We will throw an exception when encountering this during the mapping as we have the foresight of what the parser doesn't create.
</li>
<li>Recursive types are all considered as toplevel types. This is not the case in the AST but we map it as such.</li>
<li>Some nodes are combined into one, for example a toplevel attribute will always be linked to its sibling do expression.</li>
<li>The ranges of some nodes are being calculated when they lead to a more accurate result.</li>
</ul>
<h3><a name="Collect-Trivia" class="anchor" href="#Collect-Trivia">Collect Trivia</a></h3>
<p>A syntax tree contains almost all the information we need to format the code.
However, there are three items that are either missing all together or require further processing:</p>
<ul>
<li>Blank lines</li>
<li>Code comments</li>
<li>Conditional directives</li>
</ul>
<p>These three items are labelled as <code>Trivia</code> in Fantomas. We need to restore them because the source code originally had them, but cannot do so purely on the AST.</p>
<h4><a name="Detecting-trivia" class="anchor" href="#Detecting-trivia">Detecting trivia</a></h4>
<p>Trivia can however be easily detected in Fantomas. Both code comments and conditional directives are present in the AST.
These are stored on the file level (in <a href="https://fsprojects.github.io/fantomas/reference/fsharp-compiler-syntax-parsedimplfileinput.html">ParsedImplFileInput</a> and  <a href="https://fsprojects.github.io/fantomas/reference/fsharp-compiler-syntax-parsedsigfileinput.html">ParsedSigFileInput</a> in the <code>trivia</code> node).</p>
<p>In both <a href="https://fsprojects.github.io/fantomas/reference/fsharp-compiler-syntaxtrivia-parsedimplfileinputtrivia.html">ParsedImplFileInputTrivia</a> and <a href="https://fsprojects.github.io/fantomas/reference/fsharp-compiler-syntaxtrivia-parsedsigfileinputtrivia.html">ParsedSigFileInputTrivia</a> we can see comments and conditional directives.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 3)" onmouseover="showTip(event, 'fs1', 3)" class="fn">a</span> <span class="o">=</span> 
   <span class="c">// comment b</span>
   <span class="id">c</span>
</code></pre>
<p>roughly translates to</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">ImplFile</span>
  <span class="pn">(</span><span class="id">ParsedImplFileInput</span>
     <span class="pn">(</span><span class="s">&quot;tmp.fsx&quot;</span><span class="pn">,</span> <span class="k">true</span><span class="pn">,</span> <span class="id">QualifiedNameOfFile</span> <span class="id">Tmp</span><span class="o">$</span><span class="id">fsx</span><span class="pn">,</span> <span class="pn">[</span><span class="pn">]</span><span class="pn">,</span> <span class="pn">[</span><span class="pn">]</span><span class="pn">,</span>
      <span class="pn">[</span><span class="id">SynModuleOrNamespace</span>
         <span class="pn">(</span><span class="pn">[</span><span class="id">Tmp</span><span class="pn">]</span><span class="pn">,</span> <span class="k">false</span><span class="pn">,</span> <span class="id">AnonModule</span><span class="pn">,</span>
          <span class="pn">[</span><span class="id">Let</span>
             <span class="pn">(</span><span class="k">false</span><span class="pn">,</span>
              <span class="pn">[</span><span class="id">SynBinding</span><span class="pn">(</span><span class="o">..</span><span class="pn">.</span><span class="pn">)</span><span class="pn">]</span><span class="pn">,</span>
              <span class="id">tmp</span><span class="pn">.</span><span class="id">fsx</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">0</span><span class="o">--</span><span class="n">3</span><span class="pn">,</span><span class="n">4</span><span class="pn">)</span><span class="pn">)</span><span class="pn">]</span><span class="pn">,</span> <span class="id">PreXmlDocEmpty</span><span class="pn">,</span> <span class="pn">[</span><span class="pn">]</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="id">None</span><span class="pn">,</span> <span class="id">tmp</span><span class="pn">.</span><span class="id">fsx</span> <span class="pn">(</span><span class="n">1</span><span class="pn">,</span><span class="n">0</span><span class="o">--</span><span class="n">3</span><span class="pn">,</span><span class="n">4</span><span class="pn">)</span><span class="pn">,</span>
          <span class="pn">{</span> <span class="id">ModuleKeyword</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="id">None</span>
            <span class="id">NamespaceKeyword</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 6)" onmouseover="showTip(event, 'fs3', 6)" class="id">None</span> <span class="pn">}</span><span class="pn">)</span><span class="pn">]</span><span class="pn">,</span> <span class="pn">(</span><span class="k">false</span><span class="pn">,</span> <span class="k">false</span><span class="pn">)</span><span class="pn">,</span>
      <span class="pn">{</span> <span class="id">ConditionalDirectives</span> <span class="o">=</span> <span class="pn">[</span><span class="pn">]</span>
        <span class="id">CodeComments</span> <span class="o">=</span> <span class="pn">[</span><span class="id">LineComment</span> <span class="id">tmp</span><span class="pn">.</span><span class="id">fsx</span> <span class="pn">(</span><span class="n">2</span><span class="pn">,</span><span class="n">3</span><span class="o">--</span><span class="n">2</span><span class="pn">,</span><span class="n">15</span><span class="pn">)</span><span class="pn">]</span> <span class="pn">}</span><span class="pn">)</span><span class="pn">)</span>
</code></pre>
<p>The AST does contain a node for the line comment, but we cannot restore it when we are processing the let binding.<br />
There is no link between the line comment and the let binding.</p>
<p>All trivia face this problem, so we need to process them separately.<br />
We do this in <code>Trivia.collectTrivia</code>.</p>
<p>Note: blank lines are detected differently, we go over all the lines via the <code>ISourceText</code>.</p>
<h4><a name="Inserting-trivia" class="anchor" href="#Inserting-trivia">Inserting trivia</a></h4>
<p>Once we have the trivia, we can insert them to a <code>Node</code> they belong to.
This is one of the key reasons why we work with our own tree. We can add the trivia information to the best suitable child node in the <code>Oak</code>.
Every <code>Node</code> can have <code>ContentBefore</code> and <code>ContentAfter</code>, this is how we try to reconstruct everything.</p>
<div class="mermaid text-center">
graph TD
    A[Capture all trivia from AST and ISourceText] --> B
    B[Insert trivia into nodes]
 </div>
<fantomas-nav previous="./Solution%20Structure.html" next="./Traverse.html"></fantomas-nav>

        <div class="fsdocs-tip" id="fs1">val a: obj</div>
<div class="fsdocs-tip" id="fs2">val a: int</div>
<div class="fsdocs-tip" id="fs3">union case Option.None: Option&lt;&#39;T&gt;</div>

      </div>
        <div id="push"></div>
    </main>
  <script type="module" src="https://fsprojects.github.io/fantomas/content/docs-setup.js"></script>
  <!-- BEGIN SEARCH BOX: this adds support for the search box -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
  <script type="text/javascript">var fsdocs_search_baseurl = 'https://fsprojects.github.io/fantomas/';</script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.min.js"></script>
  <script type="text/javascript" src="https://fsprojects.github.io/fantomas/content/fsdocs-search.js"></script>
  <!-- END SEARCH BOX: this adds support for the search box -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
  <script type="module" src="https://fsprojects.github.io/fantomas/content/webcomponents.js"></script>
  <script type="module">
      import mermaid from "https://cdn.skypack.dev/mermaid@9.2.2";
      mermaid.initialize({
          startOnLoad: true,
          theme: "base",
          themeVariables: {
              primaryColor: '#eff5f7'
          }
      });
  </script>
</body>
</html>